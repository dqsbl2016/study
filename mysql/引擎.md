# 引擎

## innoDB

* 5.5版本及之后版本默认存储引擎
* 支持行锁，表锁
  * InnoDB的行锁是实现在索引上的，而不是锁在物理行记录上。潜台词是，如果访问没有命中索引，也无法使用行锁，将要退化为表锁。 
* 支持事务ACID
* 采用聚簇索引方式存储数据（叶子节点记录索引值及数据记录，二级索引叶子节点指向聚簇索引主键索引值，所以需要二次查询）
  * 数据未单独存储
  * 主键索引叶子节点记录主键索引值及行数据记录
    * 如果表定义了PK，则PK就是聚集索引； 
    * 如果表没有定义PK，则第一个非空unique列是聚集索引； 
    * 否则，InnoDB会创建一个隐藏的row-id作为聚集索引； 
  * 普通索引叶子节点记录索引值及对应行主键值
* 支持崩溃恢复
* 支持外键约束
* 未保存表的行数，select count(*) 时需要全表扫描
  * **常见坑**：只有查询全表的总行数，MyISAM才会直接返回结果，当加了where条件后，两种存储引擎的处理方式类似。 
* 数据文件只有2个 frm文件记录表结构等信息   ibd记录索引及数据（聚簇索引方式存储）
* 不建议用较长的列做主键，因为普通索引会存储主键值，会导致普通索引过大。
* 建议使用自增的key做主键，这样插入数据时会顺序插入，不至于大量索引分裂，行记录移动。

## myisam

* 5.5版本之前默认存储引擎
* 支持表锁
* 不支持事务
* 数据采用非聚簇索引方式存储（myisam中的主键索引与普通索引没有本质区别，他们都属于非聚簇索引。）
  * 数据单独存储，有连续的聚集区域
  * 主键索引叶子节点记录主键索引值及对应行记录的指针
  * 普通索引叶子节点记录索引值及对应行记录的指针
* 不支持崩溃恢复
* 不支持外键
* 保存表数据行数，select count(*) 无需扫描表
  * **常见坑**：只有查询全表的总行数，MyISAM才会直接返回结果，当加了where条件后，两种存储引擎的处理方式类似。 
* 数据文件有3个  frm文件记录表结构等信息   myd文件存放数据记录 myi记录索引内容

